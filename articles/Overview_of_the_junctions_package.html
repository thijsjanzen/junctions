<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Overview_of_the_junctions_package • junctions</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Overview_of_the_junctions_package">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">junctions</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/junctions_vignette.html">Junctions Vignette</a></li>
    <li><a class="dropdown-item" href="../articles/Overview_of_the_junctions_package.html">Overview_of_the_junctions_package</a></li>
    <li><a class="dropdown-item" href="../articles/phased_and_unphased_data.html">Phased and unphased data</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/thijsjanzen/junctions/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Overview_of_the_junctions_package</h1>
                        <h4 data-toc-skip class="author">Thijs
Janzen</h4>
            
            <h4 data-toc-skip class="date">5/6/2021</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/thijsjanzen/junctions/blob/master/vignettes/Overview_of_the_junctions_package.Rmd" class="external-link"><code>vignettes/Overview_of_the_junctions_package.Rmd</code></a></small>
      <div class="d-none name"><code>Overview_of_the_junctions_package.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="overview-of-the-junctions-package">Overview of the junctions package<a class="anchor" aria-label="anchor" href="#overview-of-the-junctions-package"></a>
</h2>
<p>The junctions package has since it’s creation in 2018 been updated
with a range of extended functionality, spawning many associated
functions. This vignette is aimed at providing a clear overview of the
several functions available, and displaying how you can potentially use
these functions.</p>
<div class="section level3">
<h3 id="simulation-functions">Simulation functions<a class="anchor" aria-label="anchor" href="#simulation-functions"></a>
</h3>
<p>Because many of the other functions rely on input data, we will first
explore functions that simulate such data. These functions simulate the
accumulation of junctions in a Wright-Fisher model, with random mating,
fixed population size, non-overlapping generations and recombination
modeled with the mean number of crossovers drawn from a Poisson
distribution with the size in Morgan of the chromosome as the mean of
the distribution. The location of the crossovers is drawn from a uniform
distribution across the chromosome. In all simulations, only one pair of
chromosomes per individual is simulated.</p>
<div class="section level4">
<h4 id="phased-and-unphased-simulations">Phased and unphased simulations<a class="anchor" aria-label="anchor" href="#phased-and-unphased-simulations"></a>
</h4>
<p>These are the most recent additions to the package, where the user
can simulate the process of junction accumulation, and the detection of
ancestry at a given set of markers. These simulations are designed to
reflect the type of data one might get upon sequencing individuals.
Simulations aimed more at matching analytical results can be found later
on. The data is returned in long data format, and the user can, if
required, superimpose phasing inaccuracy or reduced marker coverage.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">simulated_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_phased_unphased.html">sim_phased_unphased</a></span><span class="op">(</span>pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                     freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                     total_runtime <span class="op">=</span> <span class="fl">100</span>,</span>
<span>                                     size_in_morgan <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     markers <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                                     time_points <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">100</span>, by <span class="op">=</span> <span class="fl">10</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="mathematical-simulations">Mathematical simulations<a class="anchor" aria-label="anchor" href="#mathematical-simulations"></a>
</h4>
<p>In Janzen et al. 2018, two separate scenario’s were explored: either
using a finite or an infinite chromosome, where finite or infinite was
referring to the number of junctions possibly spaced on a chromosome. To
retain the functionality suggested in that paper, and also to retain the
code used for that paper, this functionality is available in the
functions and . These functions are aimed at performing stochastic
simulations of the accumulation of junctions, and how the placing and
spacing of markers affects the detection of such junctions. As such, the
simulations return the population average number of accumulated
junctions, and the number of detected junctions (given markers, only for
the infinite chromosome), but not the actual local ancestry.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">junctions_fin_chrom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_fin_chrom.html">sim_fin_chrom</a></span><span class="op">(</span>pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                     freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                     total_runtime <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                                     morgan <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     R <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="co"># the number of crossover sites</span></span>
<span></span>
<span><span class="va">junctions_inf_chrom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_inf_chrom.html">sim_inf_chrom</a></span><span class="op">(</span>pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                     freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                     total_runtime <span class="op">=</span> <span class="fl">200</span>,</span>
<span>                                     morgan <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     markers <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">junctions_inf_chrom</span><span class="op">$</span><span class="va">avgJunctions</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time since admixture"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Number of junctions"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">junctions_fin_chrom</span><span class="op">$</span><span class="va">avgJunctions</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">junctions_inf_chrom</span><span class="op">$</span><span class="va">detectedJunctions</span>, col <span class="op">=</span> <span class="st">"lightgreen"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/legend.html" class="external-link">legend</a></span><span class="op">(</span><span class="st">"topleft"</span>, legend <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Finite chromosome"</span>, <span class="st">"Infinite chromosome"</span>,</span>
<span>                             <span class="st">"Infinite chromosome detected"</span><span class="op">)</span>,</span>
<span>       col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"blue"</span>, <span class="st">"darkgreen"</span>, <span class="st">"lightgreen"</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">1</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_of_the_junctions_package_files/figure-html/sim%20fin%20chrom-1.png" width="672"></p>
</div>
<div class="section level4">
<h4 id="backcrossing">Backcrossing<a class="anchor" aria-label="anchor" href="#backcrossing"></a>
</h4>
<p>Lastly, one additional function is available, where instead of random
mating, the individuals cross back with one of the parents, as used in
Lavretsky et al. 2019. This function also focuses mainly on the average
number of junctions and not on the distribution of local ancestry</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">backcross_result</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/sim_backcrossing.html">sim_backcrossing</a></span><span class="op">(</span>population_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                     freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                     total_runtime <span class="op">=</span> <span class="fl">20</span>,</span>
<span>                                     size_in_morgan <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                                     number_of_markers <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">backcross_result</span><span class="op">$</span><span class="va">average_junctions</span>,</span>
<span>     type <span class="op">=</span> <span class="st">"l"</span>, lwd <span class="op">=</span> <span class="fl">2</span>,</span>
<span>     col <span class="op">=</span> <span class="st">"darkgreen"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time since admixture"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Number of junctions"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_of_the_junctions_package_files/figure-html/backcrossing-1.png" width="672"></p>
</div>
</div>
<div class="section level3">
<h3 id="inferring-the-time-since-admixture">Inferring the time since admixture<a class="anchor" aria-label="anchor" href="#inferring-the-time-since-admixture"></a>
</h3>
<div class="section level4">
<h4 id="junction-based-methods">Junction based methods<a class="anchor" aria-label="anchor" href="#junction-based-methods"></a>
</h4>
<p>Across Janzen et al. 2018 and Janzen &amp; Miró Pina 2022, several
equations have been proposed to infer the time since admixture,
depending on the data available. Firstly, following equation 14 in
Janzen et al. 2018, one can calculate the time since admixture based on
the number of junctions detected in one chromosome, given a number of
regularly spaced markers:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/estimate_time.html">estimate_time</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">10</span>, N <span class="op">=</span> <span class="fl">1000</span>, R <span class="op">=</span> <span class="fl">1000</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, C <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 20.2909</span></span></code></pre>
<p>In reality, markers are rarely regularly spaced and the practical
applications of equation 14 of Janzen et al. 2018 are limited.
Therefore, Janzen &amp; Miró Pina propose an exact method (Equation 3)
of calculating the expected number of junctions in a single chromosome,
given the distribution of markers across the chromosome.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/estimate_time_one_chrom.html">estimate_time_one_chrom</a></span><span class="op">(</span>J <span class="op">=</span> <span class="fl">10</span>, N <span class="op">=</span> <span class="fl">1000</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                        marker_distribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1000</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 20.5195</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="local-ancestry-based-methods">Local ancestry based methods<a class="anchor" aria-label="anchor" href="#local-ancestry-based-methods"></a>
</h4>
<p>Mathematically, the total number of junctions is very tractable,
however this discards all the ancestry data collected at the respective
markers. Janzen &amp; Miró Pina therefore provide an alternative
likelihood based method, that also allows for the joint inference of the
time since admixture across data resulting from multiple chromosomes
from the same individual. It is assumed here that the individual of
interest is haploid, since only data from a single chromosome is
available. For the example below, we make use of previously simulated
data and pretend that the different chromosomes resulting from different
individuals are, in fact, sampled from the same individual. This is of
course completely mathematically incorrect, but is used here to
demonstrate how to use the functions. The function requires input of a
so called ‘ancestry_matrix’, which is a matrix with three columns: 1)
chromosome indicator, 2) position on respective chromosome in Morgan and
3) local ancestry. The function returns the maximum likelihood estimate
of the time, and the associated likelihood.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancestry_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">simulated_pop</span>, <span class="va">simulated_pop</span><span class="op">$</span><span class="va">time</span> <span class="op">==</span> <span class="fl">100</span><span class="op">)</span></span>
<span><span class="va">ancestry_matrix</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ancestry_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">individual</span>,</span>
<span>                                                  <span class="va">location</span>, <span class="va">anc_chrom_1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/estimate_time_haploid.html">estimate_time_haploid</a></span><span class="op">(</span>ancestry_matrix <span class="op">=</span> <span class="va">ancestry_matrix</span>,</span>
<span>                      N <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                      freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $time</span></span>
<span><span class="co">## [1] 89.8088</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## $loglikelihood</span></span>
<span><span class="co">## [1] -1517.002</span></span></code></pre>
<p>If instead, you have diploid ancestry data, you can make use of the
function . The function can calculate the ancestry assuming either that
the data is phased, or unphased. Below, we take the same data, and add
‘fake’ individual information. We do this, because the function requires
an input matrix with the following five columns: 1) individual, 2)
chromosome, 3) location along respective chromosome in Morgan, 4)
ancestry chromosome 1, 5) ancestry chromosome 2. Please note that in the
case of unphased data, it does not matter how ancestry is split out
across the two chromosomes. Note that although we are in possession of
phasing information (because we are using simulation output), we can
‘fake’ the data to be unphased, in which case the analysis does not take
into account phasing information. We can specify the analysis type,
which focuses on how the likelihoods are grouped. By default, the
likelihood is calculated jointly for all chromosomes within the same
individual. Thus, if multiple individuals are provided, multiple time
estimates are returned. Instead, one can also specify to group the data
by chromosome, jointly optimizing across individuals (not recommended).
Lastly, one can specify to split out the data per individual chromosome
and provide separate estimates for each chromosome found in each
individual.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancestry_matrix</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ancestry_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">individual</span>,</span>
<span>                                                  <span class="va">location</span>,</span>
<span>                                                  <span class="va">anc_chrom_1</span>, <span class="va">anc_chrom_2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">ancestry_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">ancestry_matrix</span><span class="op">$</span><span class="va">individual</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                         <span class="va">ancestry_matrix</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_phased</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_time_diploid.html">estimate_time_diploid</a></span><span class="op">(</span>ancestry_information <span class="op">=</span> <span class="va">ancestry_matrix</span>,</span>
<span>                                  analysis_type <span class="op">=</span> <span class="st">"individuals"</span>,</span>
<span>                                  phased <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                                  pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                  freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_unphased</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimate_time_diploid.html">estimate_time_diploid</a></span><span class="op">(</span>ancestry_information <span class="op">=</span> <span class="va">ancestry_matrix</span>,</span>
<span>                                    analysis_type <span class="op">=</span> <span class="st">"individuals"</span>,</span>
<span>                                    phased <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                                    pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                    freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">t_phased</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   individual  time loglikelihood</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>          1  88.6        -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">974.</span></span></span></code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">t_unphased</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   individual  time loglikelihood</span></span>
<span><span class="co">##        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>          1  87.4        -<span style="color: #BB0000; text-decoration: underline;">2</span><span style="color: #BB0000;">641.</span></span></span></code></pre>
<p>We thus find that in this specific case, the time estimate using
unphased data is slightly more accurate that the phased case, although
they are both close.</p>
</div>
</div>
<div class="section level3">
<h3 id="likelihood-functions">Likelihood functions<a class="anchor" aria-label="anchor" href="#likelihood-functions"></a>
</h3>
<p>If we would like to investigate the likelihood profile around the
maximum, for instance to assess how accurate our estimate is, we can do
so with the respective likelihood functions.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancestry_matrix</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ancestry_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">individual</span>, <span class="va">location</span>,</span>
<span>                                                  <span class="va">anc_chrom_1</span>, <span class="va">anc_chrom_2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">time_points</span> <span class="op">&lt;-</span> <span class="fl">80</span><span class="op">:</span><span class="fl">120</span></span>
<span><span class="va">ll_phased</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/log_likelihood_diploid.html">log_likelihood_diploid</a></span><span class="op">(</span><span class="va">ancestry_matrix</span>,</span>
<span>                                    pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                    freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                    t <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>                                    phased <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">ll_unphased</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/log_likelihood_diploid.html">log_likelihood_diploid</a></span><span class="op">(</span><span class="va">ancestry_matrix</span>,</span>
<span>                                      pop_size <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                      freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                      t <span class="op">=</span> <span class="va">time_points</span>,</span>
<span>                                      phased <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">to_plot</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="fu">::</span><span class="fu"><a href="https://tibble.tidyverse.org/reference/tibble.html" class="external-link">tibble</a></span><span class="op">(</span><span class="va">time_points</span>, <span class="va">ll_phased</span>, <span class="va">ll_unphased</span><span class="op">)</span></span>
<span><span class="va">to_plot</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">tidyr</span><span class="fu">::</span><span class="fu"><a href="https://tidyr.tidyverse.org/reference/gather.html" class="external-link">gather</a></span><span class="op">(</span>key <span class="op">=</span> <span class="st">"phasing"</span>, value <span class="op">=</span> <span class="st">"loglikelihood"</span>, <span class="op">-</span><span class="va">time_points</span><span class="op">)</span> <span class="op">%&gt;%</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span></span>
<span>      <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time_points</span>, y <span class="op">=</span> <span class="va">loglikelihood</span>, col <span class="op">=</span> <span class="va">phasing</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">ggplot2</span><span class="fu">::</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_of_the_junctions_package_files/figure-html/likelihood-1.png" width="672"></p>
<p>Alternatively, we can calculate the haploid log likelihood, e.g. the
likelihood of observing the ancestry in one chromosome:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ancestry_matrix</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">ancestry_data</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">individual</span>, <span class="va">location</span>,</span>
<span>                                                  <span class="va">anc_chrom_1</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ll_haploid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/log_likelihood_haploid.html">log_likelihood_haploid</a></span><span class="op">(</span><span class="va">ancestry_matrix</span>,</span>
<span>                                     N <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                                     freq_ancestor_1 <span class="op">=</span> <span class="fl">0.5</span>,</span>
<span>                                     t <span class="op">=</span> <span class="va">time_points</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ll_haploid</span> <span class="op">~</span> <span class="va">time_points</span>, type <span class="op">=</span> <span class="st">"l"</span>,</span>
<span>     xlab <span class="op">=</span> <span class="st">"Time since admixture"</span>,</span>
<span>     ylab <span class="op">=</span> <span class="st">"Loglikelihood"</span><span class="op">)</span></span></code></pre></div>
<p><img src="Overview_of_the_junctions_package_files/figure-html/likelihood%20haploid-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="expected-number-of-junctions">Expected number of junctions<a class="anchor" aria-label="anchor" href="#expected-number-of-junctions"></a>
</h3>
<p>Mathematically, one can calculate the expected number of junctions.
The first equation covered here covers the derivations obtained in
Janzen et al. 2018:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/number_of_junctions.html">number_of_junctions</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">100</span>, R <span class="op">=</span> <span class="fl">100</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, C <span class="op">=</span> <span class="fl">1</span>, t <span class="op">=</span> <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 33.33332</span></span></code></pre>
<p>This equation however, has to assume that the markers are equally
spaced, that is, that the distance between each consecutive marker pair
is equal. This is rarely the case in empirical data, and a better
version is provided by the function :</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/number_of_junctions_markers.html">number_of_junctions_markers</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">100</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, t <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>                            marker_distribution <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html" class="external-link">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="fl">100</span>, <span class="fl">0</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 27.16975</span></span></code></pre>
<p>Similarly, we can calculate the probability of observing a junction
in between two markers, given an amount of recombination (in Morgan)
between these two markers:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/number_of_junctions_di.html">number_of_junctions_di</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">100</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, t <span class="op">=</span> <span class="fl">1000</span>, di <span class="op">=</span> <span class="fl">1e-5</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0009914297</span></span></code></pre>
<p>Lastly, we have included a function that calculates the expected
number of junctions after a number of generations, in a backcrossing
mating scheme.</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/number_of_junctions_backcross.html">number_of_junctions_backcross</a></span><span class="op">(</span>H_0 <span class="op">=</span> <span class="fl">0.5</span>, C <span class="op">=</span> <span class="fl">1</span>, t <span class="op">=</span> <span class="fl">10</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.009765625</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="mathematical-expressions">Mathematical expressions<a class="anchor" aria-label="anchor" href="#mathematical-expressions"></a>
</h3>
<p>Following Janzen et al. 2018, there are a number of equations that
might be useful. Firstly, there is an equation to calculate the upper
limit of junctions that can be packed in a chromosome, given the number
of (regularly spaced) markers:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calc_k.html">calc_k</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, R <span class="op">=</span> <span class="fl">1000</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, C <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 333.3333</span></span></code></pre>
<p>Any time spent after the population has reached this upper limit
remains “invisible” for inference purposes, and thus it can be useful to
calculate the upper limit of age inference, coined ‘Maximum Accurate
Time’, following equation 15 in Janzen et al. 2018:</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/calculate_MAT.html">calculate_mat</a></span><span class="op">(</span>N <span class="op">=</span> <span class="fl">1000</span>, R <span class="op">=</span> <span class="fl">1000</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, C <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 3869.857</span></span></code></pre>
<p>Similarly, we can estimate the error induced in time inference, where
the error is given by the amount of time difference induced if we were
to infer one junction less (or more), following Equations 3 &amp; 4 in
the Supplementary information of Janzen et al. 2018.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/time_error.html">time_error</a></span><span class="op">(</span>t <span class="op">=</span> <span class="fl">30</span>, N <span class="op">=</span> <span class="fl">1000</span>, R <span class="op">=</span> <span class="fl">1000</span>, H_0 <span class="op">=</span> <span class="fl">0.5</span>, C <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 0.0697948</span></span></code></pre>
<p>This concludes a runthrough of all the available functions in the
junctions package. Feel free to contact me if you feel anything is
missing, or to create an issue if you run into a problem.</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Thijs Janzen.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
